#pragma once

#include "solitaire.h"
#include "types.h"

#include <GLES3/gl3.h>

#include <cstring>

#define CARD_TEXTURE_WIDTH 71
#define CARD_TEXTURE_HEIGHT 96

union RGBA {
  struct {
    u8 r, g, b, a;
  };
  u8 v[4];
};

RGBA white  = {{0xff, 0xff, 0xff, 0xff}};
RGBA black  = {{0x00, 0x00, 0x00, 0xff}};
RGBA red    = {{0xff, 0x00, 0x00, 0xff}};
RGBA green  = {{0x00, 0xff, 0x00, 0xff}};
RGBA blue   = {{0x00, 0x00, 0xff, 0xff}};
RGBA pink   = {{0xff, 0x00, 0xff, 0xff}};
RGBA yellow = {{0xff, 0xff, 0x00, 0xff}};
RGBA cyan   = {{0x00, 0xff, 0xff, 0xff}};

RGBA table_green = {{0x00, 0xA8, 0x54, 0xff}};
RGBA card_back   = {{0xff, 0x00, 0xff, 0xff}};

struct pixels {
  u8 *data;
  int w, h;
};

struct glyph_sheet {
  int w, h;
  int glyph_w;

  const char *data;
};

glyph_sheet rank_sheet = {143, 12, 11, "\
00000100000000111110000011111110000000011000001111111000000111100000111111100000111110000001111100001100111100000001111000001111100001111011110\
00000100000001111111000011111110000000111000001111111000001111100000111111100001111111000011111110001101111110000001111000011111110001111011110\
00001110000001100011000011001100000001111000001100000000011100000000110001100001100011000011000110001101100110000000110000011000110000110011000\
00001110000000000011000000011000000011111000001100000000011000000000000011000001100011000011000110001101100110000000110000011000110000110111000\
00011011000000000111000000110000000111011000001111110000011111100000000011000001100011000011000110001101100110000000110000011000110000111110000\
00011011000000001110000001111100001110011000001111111000011111110000000110000000111110000011000110001101100110000000110000011000110000111100000\
00110001100000011100000001111110001111111110000000011000011000110000000110000001111111000011111110001101100110000000110000011000110000111110000\
00111111100000111000000000000110001111111110000000011000011000110000000110000001100011000001111110001101100110000000110000011000110000110111000\
01111111110001110011000000000110000000011000001100011000011000110000001100000001100011000000000110001101100110001100110000011111110000110001100\
01100000110001100011000011000110000000011000001100011000011000110000001100000001100011000000001110001101100110001100110000001111100000110001100\
11110001111001111111000011111110000000111100001111111000011111110000001100000001111111000001111100001101111110001111110000000001110001111011110\
11110001111001111111000001111100000000111100000111110000001111100000001100000000111110000001111000001100111100000111100000000000110001111011110\
"};

glyph_sheet suit_sheet_small = {44, 11, 11, "\
00000000000000011100000000000000000000100000\
00111011100000111110000000010000000001110000\
01111011110000111110000000111000000011111000\
01111111110000111110000001111100000111111100\
01111111110011011101100011111110001111111110\
01111111110111111111110011111110001111111110\
00111111100111111111110011111110001111111110\
00011111000111111111110001111100000110101100\
00001110000011101011100000111000000001110000\
00000100000000011100000000010000000001110000\
00000000000000011100000000000000000000000000\
"};

glyph_sheet suit_sheet_smaller = {36, 10, 9, "\
011202110000111000000010000000010000\
111101111001111100000111000000111000\
111111111001111100002111200001111100\
111111111010111010021111120011111110\
211111112111111111011111110111111111\
011111110111111111021111120111111111\
001111100111111111002111200111111111\
000111000011010110000111000011010110\
000010000000212000000010000000212000\
000000000000111000000000000000111000\
"};

glyph_sheet sheet_suit_L = {60, 15, 15, "\
001111000111100000000111000000000000010000000000000010000000\
011111101111110000001111100000000000111000000000000111000000\
111111101111111000011111110000000001111100000000001111100000\
111111111111111000011111110000000011111110000000011111110000\
111111111111111000011111110000000111111111000000111111111000\
111111111111111000001111100000000111111111000001111111111100\
111111111111111001110111011100001111111111100011111111111110\
011111111111110011111111111110011111111111110011111111111110\
011111111111110111111111111111001111111111100111111111111111\
001111111111100111111111111111000111111111000111111111111111\
000111111111000111111111111111000111111111000111111111111111\
000011111110000011111010111110000011111110000111111010111111\
000001111100000001110010011100000001111100000011110010011110\
000000111000000000000111000000000000111000000000000111000000\
000000010000000000001111100000000000010000000000001111100000\
"};

glyph_sheet card_backs = {8, 8, 8, "\
70711077\
07110307\
11103330\
01070333\
30777033\
33070103\
33307110\
03071107\
"};

glyph_sheet sheet_art = {39, 39, 39, "\
000000000000000000010000000000000000000\
000000000000000000111000000000000000000\
000000000000000001111100000000000000000\
000000000000000011111110000000000000000\
000000000000000111101111000000000000000\
000000000000001111010111100000000000000\
000000000000011110111011110000000000000\
000000000000111101111101111000000000000\
000000000001111011111110111100000000000\
000000000011110111101111011110000000000\
000000000111101111010111101111000000000\
000000001111011110111011110111100000000\
000000011110111101101101111011110000000\
000000111101111011010110111101111000000\
000001111011110110111011011110111100000\
000011110111101110111011101111011110000\
000111101111011111010111110111101111000\
001111011111101111101111101111110111100\
001110111111110111010111011111111011100\
011110111011111010111010111110111011110\
011101111101101101101101101101111101110\
011101111101111010111010111101111101110\
111011110011110111010111011110011110111\
111011101111101111101111101111101110111\
111011101111011111111111110111101110111\
111011101110111110111011111011101110111\
111011110001111101010101111100011110111\
111011111111111011101110111111111110111\
111011111111110111111111011111111110111\
111101111111101111111111101111111101111\
011100111110011110111011110011111001110\
011111000001111100111001111100000111110\
001111111111111000111000111111111111100\
000111111111110001111100011111111111000\
000001111111000001111100000111111100000\
000000000000000011111110000000000000000\
000000000000000011111110000000000000000\
000000000000000111111111000000000000000\
000000000000001111111111100000000000000\
"};

glyph_sheet face_sheet = {564, 74, 47, "\
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
066666666603363336363363633363066666666666666600666666666660060606600035555506666666666666666006666666666666660505550555055505555550666666660066666666003303330303303033303066666666666666600555555555530036060600606666666666666666666666006666666666666666055505550555055555555066666660066666666603633363363363363363006666666666666600605555555550330660606005066666666666666666666006666666666666055550555055555555555550666666660066600666030333030330303330330666666666666666600666666666600600606063050055550666666666666666006666666666666660555555555555555555550666666660\
006600066660336336363363633630663334666433366600666666666600606060600035055066633346664333666006663334666433366000500050005000500506666666660006666666600330330303303033030666666000666666600055555555530036006060006666666666660006666666006666666000666666605000500050005505550666666660066666666660363363363363363630066666663666666600660555550050330606060605506666666666636666666006666666366666605500050005505555555506660006600066055066603033030330303303306666666606666666600660666666000006060063055055506666666066666666006666666606666666055555550505050505006666666660\
030660506666033666366663666300633333464333336600666666666000060066600035555066333334643333366006633333464333336605555555555550550066006666660030666666600033000300003000306666660000066666600605555500530036066006006666666666600000666666006666660000066666660333333333333000506666666660066666666666036663366663366300666666633366666600660555555550330666006000506666666666333666666006666663336666660333333335000550555066605066030060503506660300030000300033066666666000666666600660666666006060066063055555506666660006666666006666666000666666600505050303030303066666666660\
030660550666033333333333333006333333363333333600666666666050606606660035050663333333633333336006333333363333333660333333333555550660550666660033066666022033333333333333006666600000006666600660555505330036060660606666666666000000066666006666600000006666666000000000000333066666666060006666666666603333333333333306666666333336666600666055550050330660660600050666666663333366666006666633333666660000000003333500050066055066030060503506666033333333333333066666660000066666600660666666000606606603050055066666600000666666006666660000066666630303033333333330666666666600\
030660550666000000000000000006333333333333333600666666660050066660060033550663333333333333336006333333333333333660000000000333330660550006660033306666020000000000000000066666600000006666600660555553300336006666000666666666000000066666006666600000006666666000000000000000066666660000000666666666600000000000000006666664333334666600666055555500306006666000005066666643333346666006666433333466666000000000000333330666055066030060503506666000000000000000066666600000006666600605066666060066660603055055066666000000066666006666600000006666660333330000000000666666666000\
000006055066605050505066666066333333333333333600666666660530666666600003550663333333333333336006333333333333333660666666660000000000506600660000000666220066666666050505066666600000006666600666055553300366066666600666666666000000066666006666600000006666660066666666060000066666606030005066666666600000506666666600666643333333466600666055500503300666666603005066666433333334666006664333333346666066666600600000000660550600000066055066666066666050505050666666000000000666600605066660060666666003305555506660000000006666006666000000000666660000000666666660066666660500\
063636605066605050505066006066333333333333333600666666600530000600060003355063333333333333336006333333333333333660666666660606060660506605060055506660220066666666050505066666660000066666600666050053000366000600003066666666600000666666006666660000066666606066666666060600066666606030005066666666600050506666666600666643333333466600666055555003066000600003000506666433333334666006664333333346666060066606060000000660506636360066600666666060066050505050666660000000000066600605066660360000600003305005506600000000000666006660000000000066660606060666666660606666660500\
063636660066050505050600606066433333333333334600666666605330006000600000335064333333333333346006433333333333334600000600000606060005500005060005506660005000060006050505066660006000600066600666050533003360600660003066666600060006000666006660006000600066606000060000060606066666606030005066666666605050506000600005066333333333336600666055005033060600060003300506663333333333366006633333333333666000606606060606060660066636360066055066666060600605050505066600000000000006600605066660360006000603330505066000000000000066006600000000000006660606060000060000606666660500\
060606605066050505050666666166643333333333346600666666005330666066660600030666433333333333466006643333333333346060006000600606060005500660660055506666605000600060050505066600000000000006600660555330003660666066600306666000000000000066006600000000000006600000600060060606066666606030005066660666605050500600060005063333333333333600666055550030066666066603300050633333333333336006333333333333366166666606060606060660506606060060503506666166666605050505066600000000000006600055506660360666066606330550666000000000000066006600000000000006660606060060006000066666660500\
000006055066050505050666666606643333333333346600666666053350666066660600006666433333333333466006643333333333346060666066660606060605506660660005506666605066606666050505066000000000000000600660555330033606666066600306660000000000000006006000000000000000606066606666060606066666606030005066600666605050506666066605066333333333336600660550050330606666066603330050663333333333366006633333333333660666666606060606060660550600000066055066660666666605050505066000000000000000600050506660360666066660333050660000000000000006006000000000000000660606060666606660606666660500\
030660550666050505050666666660663333333333466600666666053350666066660660000666633333333334666006664333333333366060666066660606060660000000660055506666005066606666050505066000000000000000600605003300336606666066600030660000000000000006006000000000000000606066606666060606066666606030005060050666605050506666066605066643333333466600660555500306060666066603330050666433333334666006664333333346606666666606060606060666055066030066600666606666666605050505066000000000000000600055506603360666066660633300660000000000000006006000000000000000660606060666606660606666660500\
030660550666050505050666006100666333333333666600666666053350660006666060000066663333333336666006666333333333666060666066660606066066033330660005506660505066606666050505066000000000000000600055033000366066660006603033060000000000000006006000000000000000606066606666060606066666606030000005506666605050506666066605066643333333466600605505003306006660006603330050666433333334666006664333333346600166666660606060606066055066030066055066600660061605050505066000000000000000600605066603600660006666033300660000000000000006006000000000000000660606060666606660606666660500\
030660506666050505050600066066666633333336666600666660533550666666666066000006666333333366666006666633333336660606660006666060606060000000060055506660505066000666050505006600000606000006600600330003366066666666603303306000006060000066006600000606000006606066000666060606066666606030035550006666605050506660006605066664333334666600660550033066066666666603333005066643333346666006666433333466666000060660606060606066605066030060503506666066001605050505066000000606000000600605066603600666666666063330660000006060000006006000000606000000660606060666000660606666660500\
030600066600050505050666666066666663333366666600666660533500060006660506600000666633333666666006666663333366660606666666666066060600303030300000506660005066666666050500550660006606600066600666000033660306660006000300330600066066000666006660006606600066066000666006060606000666606030005000066666605050506666666605000666333336666600666000330660306660006050333005066663333366666006666633333666666066000666060606060606660006030060503506666066666605050505500600006606600006600000006606000060006660306333066000066066000066006600006606600006660606060600666060606666660500\
030666666055500505050666600066666666333666066600666660533005066066605506660000006663336666666006666666333666666006060006666606060603333333000055506605505606000666050005500666666000666666600666600036660030666066000030033066660006666666006666666000666666000066000666060606066066606030035006666660055050506660006065055066633366666600666603306660030666066050033005066666333666666006666663336666666600666666606060606060666666030060503506666000666055050505555066666000666666600055506036000066066603006333006666660006666666006666666000666666000606060606000660060066660500\
030666660550505050050666666066666666636600300600666660530500506666055000666000000066366666666006666666636660000066066666606060606600333330660000506605055006666660050550000006660000066666600666000336600500066660500003003306600000666666006666660000066666606066666666060660606006606030005066666605505050500666666005505066663666666600666033066605500066660550603005066666636666666006666666366666666066666600066060606060666666030066055066666066666055055050505506660000066666600600066036000506666000500633300666600000666666006666660000066660660606060666666660606606660500\
030666660505505050503336666000000666666603330600666660506500050000550005066600000066666666666006666666666000300660606660606060666066000306330055506605550030666603050050006060666666666666600660003360035350500005035530330030666666666666006666666666666660006060666060060600060030006030035066666605005005036066660630555066666666666000660330000060555000000550600005066666666666666006600066666666666006666066606060606060666666030060000066660066666300505050550506666666666666600055506036050050000505055063330066666666666666006666666666666606060606060660666060606606660500\
030666660550055050033333000550555066666660306600666660056050005555000050606660000666600600666006666666000000030006606060600066600606660003300055500660003033000033305550060063006666666666000600033606603533505053355306033003066600666666006666666666666606606060606060600606060333306030005066666605550550333300003333000006666666660300603300600006000055550006000005066666600066666006060600066666006066666060066060606060666666030060666006000016633330500505005506666666666666600055506000055005050500550006666006666666336666006666666666660006006606060060606060660050060500\
030666666055550500333333333055005066660000306600666600505365000000000536500066606666055055066006666600030660033060066060660600066666003000000005066003030033330033300000005063330066666660500000300000000355333335553000003303066033006666006666666666666606066060606060060666003533306030035066666600000000333333333330060500066666605000033006060000666600006660006005066660055006666006006060606660600666666006660606060606666666030066006600000000333330055050555006666666666666600600066000055550000055500000000300666633003366006666666666000500666066060660600066000500600500\
030666666000000055003333333005555066606660306600666055550560550000555065000000006666053330666006660066030666003300660060060550660660303050000060666600303035530003006600605063353600666605500003555000006003555555330606050303060300330666006666666666600006660606030606603000335533306030005066660030006000003333333000000506000666605300330600600000000666666000600050066660500550606000060606060660666666666600000000000000006666030060660000600000000000000000000000066666666666600603060006005055555505000660033330566330550336006666666600503500000600606606060503005006030500\
030666600363055555550000005550550066066666000600660005005053605555063550000666660666605355066006000606030606600330005006005550606603503000500000000603030033330600066006055063555360000055500055055506606600030003006600505030603333306666006666666600000000000030333030033330333335006030035066000503000060000000000000600500055006605000305060000600600000000006060005066605555506600000606066666005066666000000005506660550660000000060600060600000000000000000000606000666666666600605005006005505050550066000333605006633003360006666660000500050050000000060600500050060000500\
030660000003600555555555555555006300066006060600605555555505553603555006006606060060000550606000553060603060660330050500555506666035030000050066006600303035530660660060555065535560000055500555505050606000603330600005550006660003060006006666600033055006005003333333333003533330606030005000000050300000600000000060000506055030005300000506000006060000600000600060506660005066050006060666600000500000000000600550600055066055060060006000060505050505050505050600060006666666600605035500000555555500600033336050050066336603006666005050050050300505050000005030500603330500\
030006633000036000555555555000633300006600000600000050005500005555000050060666603305550005006005333006603066660033005005555500666053030500000000506603030033330066600605500063555360000055500333330555000060603530606050500050666660605550006666033333305500000500033333300035533506606030035000000005030000006060606000300500005033305000005050600006060606060600000605500666660060550006606600000330050003300006006055000605506005500003000606060000000000000000000606060030066666600005033500600505055006000333660500055506066053006600330000050305033000000505005000500603000500\
030336666330000363000000000363330000330660660600555555555006600000500050066660033055506600506003300000660306066033300055555506660530300355000060506600303035530006006305555063353360000055500333333055050060603330600555030050060006055006006600363636360550060505000330005033333066006030005000300000503000000000000030300550605500305300050005066000600006060000006055000066666005006006660030050330005030330000000000000000000060560030030600006033333333333333330600060333000660000005033500000055550060033336605030005550060005006035500500050005033355550000050305006033330500\
000003366663300003636363636333000033666000000600000500005060600000050500606003300000066605506003000003060330606003300555555066060303300005500005506603030033330600063055000063333360000055500333333300555500000300005050330050005550000066006000333333333055000050500000050333350660006030000060030000050300303030303030306050000555005000500300500600000000600000660505006006660000066006003333305006005033030055555555555555000000000000300060606003533533533533530606060300033005000005033550060055500600333363305000000005000005000533000005005005033350005533050005006030000500\
055500033666633000030000000300003366663000606600555555550060000660050500660333055506000005066000500033306033066603330555550060660033000033550060506030300035530060600555555063353360000055500505050333005055550005555000530050055506066606003000636363636305500050550000550353330600006030066060503000005030035353535353506055060005505300003005055000500000000066005005060000606660006000333330050500330003300606060606060660500000000003005060000603335053535053330600060003300555000005063350006000506003336633305033300000666605003553005050505030503355555533050050060333330500\
055055500336666330003066603000336666330066006600050500050006006606005006060330533306030600666005335000330603330600305555503066600330000333350005500003000033330306030505000063555360000055500050505050330005555555500000533005000006600006003000333333333300530005005005003553306600006030000060050300000503003030303030306005500600005000030050300550000666666600550005060000066000606003333005555050330500066666666666666605033006600030050506060600350535553505330606060330055000000005003355000055060033363330005000000006666605003350000050005000500000000000503050060300000000\
050555055003366663300306030033666633005060600600555555550606030066005006603305335300600600666003355530000060033006005555500660033000003353050055500000000355305030305555555065535560000055500505000000003350000000000500533000330300606606003000363636363600053005055555503333506003006030066000505030000050300030303030306000555000605300300500036005550000000055000305060000506606006003300555500005000506660000000000066050503300600000505006000005035335053353330600060000555550000005060335000533500333633000005503333066666605005330050505550500500666066600500050060305555000\
000050553000033666630030300366663300555066660000005050050006053306605060603305333000606066066003555035500006600000000000000003300000033333550055500600060333300503050500000063555300033055500050055555550033500005005005333303663000000006003000333330000300305000500030003333306000006030000033050005000005030030303030306006005550005000005003003600005555555500500305006005500660606003055550000005060506005555555555060500350330000005050500600500000060006000600606060005500000500005006335500533503336300066000500000660660053005530000505000500506606660660500500603050005550\
066605530055500336663003003666630055555060600000555555550060055330600066033053353006006066066005550300050000066666333333333330000000335305500055506660660355305550555555555063353303355055500505550000055503300000505005333050363303066606000550036306666000000500505555503535066003006030060063050550300000503003535353506006060055505300050050300363050000000055500360500055000060606000555000006005000500550000000050605055035033000050505000005005060606060606060600000055555500500005060033550533503363000666600050330600000003003550050505550503050606060660500500603055060550\
006660300555555033666300036663305555555066660000050000500600505530000066033053333060006600066005550355550506666300000000000006000003333355500055506066600333300005505000000060000333333055500055000505000550350000050005330550033330000066005555033066006600330500500030035533060000006030005033305000350000050300303030306006005000005000500050030636005000005500500360550550606006066005550000666000500005000033330506605005503503300005050030050055006000600060000606000550500005000005006033355055033600036600660005000005000000003350000505000500050666066605030500003300006000\
066060005000000000366630366630000000005060600000555555500600500530055000033053533060606660306005550300050506666666660333306666000033530555000055500606060355305555555555555006603355333055500300050505050055030000505005330505503663030666000550003060330600000050050555033335060000000030005066305050353000005030003030306006000050305300606005030363605063005555500363055500000000666005503300066600500050003333330506050000500000000055500630500005000000000000000000005555555005000005060603335500036000660000066000503055050005005330050505555050050606660605000505000333330000\
006666055066666660336600066330666666605066660000050055000600530553000555003053300060006003330005550355550506666666000633306060000353335550000055506060600333300530500050350666033333300055500330050000005505035005000505305500000363300066000000000060330600333050050030033333060006606600035033305000353500600503003030306006055050605000000005030636005063005000500300305000606060066005030330006600500050000000005066050000035035030050003305005555066666666666666666605505000050300005006060333333330006666666666600050555055550003530000505000050050000000005005000000000006660\
000606055060000060033066603300600000605060600000555550300060530533050000550000033006000333333000555035500000000000600000300600000003055500030055500606063553055503066603006666035533006055500363003333300005503050000005305055033033330306000330000066006600000005050555033535060066660000005066305050353000000350300353500006000503305300606060500363605063005555500033050050000000006000553033000600050050333333305060500005035035030000063050050005033333333333333333055555550053300005060606000000000000000000000000000055555005003350050050555050050555555555005000000006660000\
000666605060550000600600060060000550605066660000000503306060500553050555005503335060603333330000055550000000006660055555006600003305555000300055506060603333005550600060666660333330606055500366303666330550500000055000005000036603663000000000000006666000000000000000035533060060066600035033305000350060005335030030300000550503605000000000503636005000000000033353050305006060600000355303300060050050000000050660500335030000000000330500555550000000000000000000050500000503300005006060333333333333333333333333333000000550000030000050500050050000000005005055000500606660\
000060605060550066006033306006600550605060600000555033300600505530505333500033555000603333005003005000005555506660050305066060555555550000330055500606003553050006033306066600355306060055500033330600630000503330333305505055036060363303000660660000000330666603330000003335060066600000005066305050300000030533503003006000005033305300606060050363605033333333355530500630500000000003303553000000000005066666050000000000035530330005305000050050005006066600600600555555505333300005060600060006000600060006000600060005555000006606005005055050350003330005005000550000660000\
000060605060550066006033306006600550605060600300500333306000555330005333505035505006003330555003300005555555506066050305006660555550000050030055500000035530006606033306005503553000000055500303363060630550505550333303305000036006033330000000666006053330000003330666603300000006606600035033305000006000003053350300000030505036605000000000005036005035553333333330506363050060606003330300053300506605066666050005000003303553030053335055555550060060066606005000500500005033000000555500060006000600060006000600060000000500000006600005500050050003330005305055050050060660\
000666605060550000600600060060000550605066003500033333306060533305500555050355005060603305000000300055550330000660055555006660000000005555000055506060333330666600600060555003333060606055500000366306630000500000055000005055033666303663000666006006033553000000000000000066660000000000005063050500000030300305335000600530005033305300006060600503050353330000000000500636305000000000000003053300506605000000050005006000330355300035050000050500000000000000000000555550050330000055000000333333333333333333333333333060600500006660600500055050050000000005005000505000003000\
000060605060000060033066603300600000605500035500333333000600330000055000050335035060003055555003000555030000000600300000600000000000553055500055506003355306666003066603055503553606060055500603033330330550503505000000305500003333300363000006666006053533055505050000000660066000003300035033050006000053530030530000003530505036605000600000000050050330005555500360506363005060606003053053050000506003333333305005000600033035500050500555555503333333333333333305000500503600500500555550000000000000000000000000000606060500000006660000000050350555555555005055505005005330\
000666605066666660336600066330666666605500355000033300600060003350300555000355035006000550050000005553335300000060333600066666660505555305550055500033333306660530500050350033330060606055500660003363000005503500500050530505500000050033000660660006033333003005005033300603306000000000005060505506006030303003050060053530005033305300660060606000503003005000500360500636030500000003053053000005066000000000005000500660003303050030500005055066666666666666666605555005033005000055550555050006666666666600033333333060600500006660000005000050050000000005305000050500003530\
000060605000000000366630366630000000005003550000603066606060335350330000550035005006005555555000055503533000006660333306666666660505000305550055503335533066605555555555555035530606060055500666030366305505033500050500030550050505050003003000000006053333055505005000000603306030005500035030500006006030303000305000003530505036605000666000000005550363005555500360506363030500606000000000500005060503333330005000500666000330550005005555555000000000000000000005000050360050500500050550305000660000066000630005533306060500000003333300050500050606660605005055550505003350\
000666605555555033666300036663305555550035500000660006600060333350330660000035505006005000050000555333330000000000000000000366660505555305550055503333330000000000005055000033330066606055500660000033330055033500005000053055000505000550003060000006033553003000500503300660066033055550005000005006006030303030030500000530005033305000660600606055055063005005500000500636030050005000330530550050660503333000050000500066600005550005000050550006060000600060006005500500300505000000000500000500066006630006330550553330600500000060000330000503050666066605000500050500005330\
000060605555500366663003003666330055500355000000660660600600353350330660006033550060055555555000550353300000003333333333366666000005000305550055505533033533605555555550555035530660666055500606660303363050333500050500003305550000055505003060030066053530555550500500000066660363005500035055500606006053535353003050000030550503600600606060000550005003005550000000050363003050050000033053055050605000000005500500050060000055500050055555500000060606060606060605005000005050500300000006033050006666000363305335055330060500005506055030600500506606060605030505550505005530\
000666605550033666630030300366663300003550005500660660606000333503306060506603350600050050500005533333000000330000000000000000660000553055530055503300035553600000050503050033330600060055500600000000366303333500050055005330055555550050003060000060333330003000500050300300003333300030005000555006006030303030300305000005000503300000606066005500600503005005555555500006300300500000003305300506055555555550000500050000005555030050000055000606060060006000600000050060050505000350066066000005000660003633305335005533600500005550005030600500506606660660500500050500003550\
060060605003366663300306030033666633005500055500666006006003533503306600500660030606055555555005035330000033006600555550060033006000003555330055500000655355605555555030305035530000000055500606606003033000335000500000000053300000000505003060030060533330555555050035000636363636300030035060005550006030303030300030500000305050006600600606605000060503000550000000055500630005003000600330505066000000000006660500050000555500330000555550000600060333533505335305000006005050000506666660333305500000336333005335000533060500000055550306005000500666066600500505550505003350\
066006600336666330003066603000336666330005505500666006030603335033060600500606600600050005050005333300003300666030555550300603330603300053350055500000635553600005050306030333300003000055000600006600000500335000005555555500033050505050003060000660335530050050050003500333333333300030005000060055006030303030303003050000030500600000606000660000060500055006666666000055003050030000660033050666666666666666000503305055550033330000005500330606060335053555350530060606050500300506666600000000500033363330050550000553300500000000000306005030500000000000500050005000005330\
066060003666633000030000000300003366663300005000660500000605550333066005050066000060055555555005533000033006606005555503330666033060333000500055500000633533605555550060600355300030306050600606660605550050035000555500055550500333050505003060000603335305500005505000550363636363600030035055000605506053535353535300305000003050606600600066606000060500500660000000005000550500300000000000506606060606060600330003300505003333300005550033000600060333505353505333060000605003000506666000003330503336633300005000000053360500000503333306005005033555555330503050505050035530\
060000006663300003336363636363000033666633000000605506660000003300606005050000006060500005000000550000330306066055555500330060603306030000030055500000633333600005503600060333300303066055000660000055500050033055500003000005555003333333003060006605333305000000505000055033333333300060005005550000506030303030303030030500000300600000660000066600600505066000006000000006005003005000000000055555555555555003033050060050333330060005003300030606060353353353353353006060600030000500000500000000503363333006005550000055330500000500003060050005033550005333050050050000033500\
060660660330000333630000000003630000336666330300605006605550330066660050005000006600555555555000055300303506660555555000333066060306600000330055500000633533605555036006000355303030066050600600550600060050030555006033306060050550333333003060066033333050003300050506005506363636300660035030055060550030300000000000003050000030005000600500666660000550600000060600006000660500050006506000000000000000000003303050003305003006660000660003330600060333333333333333306000060300300500000055500030506633330060055550000005330500000503333060050305000005555333050005000500553060\
060000066000033360005555555550006300003366000300600500055503306666060050000555500005500050000000000503035066600555550050033006666030660033350055500000635553600055060066600333300303066050000055506066666050005050606035306060000555033333003060660533553000333333000500000550333333066660005033305000050030006060606000000305000000005300055060066666005506000006060606060600006050500000550060550600055060060000330005003300000600660066666600300606060000000000000000000606060003000350060605550005066333000600550505000005330500000500030600500050050500000033050305000003300660\
060606006600036005555555555555550063000000660300606055000060060606600600555306355505555555506005000003053066660555500505003306606030606035500055500000655355605550600660660355303030066006600600060300066600055500006033306000606050505555003060603333530033333333330050060055033000666660035000305506050000600000000060000030500000005000050660500066605060006000006000060600000605000006055066055000605500600000000000500000666600060066666666000600060505050505050505050600006000600300633660050050633330006005555555000005530506000503330600503050000005050500305005005050066660\
060006666606600550055000000555555503630066660300660553506666066666000055360555506350500500066000500030530660605550060050003300660603060600060055500000635553605506006600060333300303060000000666603333306030505006600300030006606605550550003060053333303333003033303000000000000666666660005066005500050060000000000000600003050006605300006605555506660500060600000000006006000060503000000006605506660550000000066666050066666060600066666666660006060000000000000000000060600060600003300336600506333000600055050505500000500506000500006005000500600000000005005000500006666660\
066030666066605555500333333005500000006666660300666033350666600000000560555000055065055550666000005030306606605506006006600330066603066006660055066660063533605000066003000355303030066660600666033003060303050606033555555300600000555300003060333553300030660603060606660000666666666660035066660006050000003333333000006000300666605000606055005066660050006000666666000000006006033003066660000000000000000666666666606606060606000066666666666600000000000000000000000060000660600033055033665033330060000505555550500000060306000503060050030506060600600600000530500666666660\
066030000666605005550000333330050555506666660300660550550666606660005635000000000563505006666000000030066666000606606066006033006603000666660050666666600333605000000033300333300303006605000666600330660303300000355533333553000000003000003060333530066606006060606066060666666666666660005066666600050600333333333330000000066666605300666600550066660500600066600006666000060600330003066666660606060606660066666600606660606060060066666666666666005550505500333330000000066006600663300336666003000000005550000055550000660006000500600500066000606606066066600500066666666660\
066030666666605550506666003300505500550666660300666006006666000066606050000555500050650066666000330006660600666000606060660003000000066666660006666666666003600600555033300003303000660055500666666006660300330603553350505335306606330006003060333306060600606060606060660666666666666660030666666666000003333000033330550555066666605000666660006666660500000600055550000600006003306003066666606060606066006066666060066666000606060066666666666666055005050050333366100006006660600666633666666600600000055005050500550000605550000506005006606060606006060660060006666666666660\
060333066666660006006666660050505055050666660300666666666660000006660500055000050005605066666003360300006066606060606660606600300066666666660066666666666660606000500503066660300555066055500666666666666030033035530500005053530063300066003060003006000606006066606060006666666666666660006666666666605550360666606305005005066666605300666666666666660500006055000000555060000033066003066666606060606060666066660066666666666000660066666666666666050550505050036666600666600000600666666666666660033300550505000050050630605550000506660660606066606606060606060666666666666660\
060030066366666666606666666050505050550666660300666666663660000000666000550666605005035066666006603333300660606060666666066000006663666666660066666600000666000000550500666666005505066050000666666000006603300300005066660005006633000666003060660060606606066666666060666666000006666660066666663666605055006666660050505055066666605000666666636666660500306055066660005506660330666003066666606060606066000666666066666666366666660066666600000666055050505505506666606666605506600666666000006666003336005000666605000630660006000506660660606666666606060606606666000006666660\
066606663336666666600066666505050055506666660300666666633366600000066605506660660500335066666000033333330606060666660006060066666633366666660066666660006666660055000506660006065055066055500666666600066660330030000660666030066630006666003060666066060606066600066000066666600066666660066666633366605505606000666050505500666666005300666666333666660500330050660666030066603306666003066666606060606060666666600666666663336666660066666660006666605555050505506660006666053050600666666600066666600333600306660660000630605550000506666006006600060606060600066666600066666660\
066666633333666666606666660505050500066600060300666666333336666000006605066600060005335066666000303030300606066066666666660606666333336666660066600066066000660550050506666666605000666050000666000660660006033003000600066603066330000666003060666600060606060066600066066000660660006660066666333336660005066666666050505066666600005000666663333366660500333050600066603066033000666003060006660606060606066600066066666633333666660066000066066000060055050505066666606666053050600660000660660000660333303066600060000606600000000506666660606066600606060606660000660660000660\
066666333333366666606600060505050506666050660300666663333333666600000660666666666055335066666006000000006060606066660006660606663333333666660066000006060000066005050506660006605050666055500660000060600000603303306666666660663300033006003060666666060606066600066060660000060600000660066664333334666605066000666050505066666000555300666643333346660500333306666666660660330055066003066050666060606060606606000066666433333466660060000006060000006605050505061006606666053050600600000060600000066033360666666666006306660506000506666660606600066606060606600000060600000060\
066663333333336660006006660505050506660550660300666633333333366660000060666600066053350666666006603333066066060606666066606066633333333366660060000000000000006605050506666066605050666055000600000000000000060330306600066660663000330550003060666666060606066660666060600000000000000060066643333333466605066606666050505066666055000000666433333334666050033306600066600603300505506003066055066060606060606666666100664333333346660060000000000000006605050505061600660066605506600600000000000000066003330666600066006306660506000506666660606660666606060606600000000000000060\
066643333333333660666666660505050506660550660300666433333333336666000066066660666053350666666006600000006606060606666066606066333333333346660060000000000000006605050506666066605006666055500600000000000000066030006660666606633003300506003060666666060606066660666060600000000000000060066643333333466605066606666050505066660500605000666433333334666050033306660666060603005555066003066055066606060606060666666660664333333346660060000000000000006605050505066666666066660066600600000000000000066003336066660666063306605550000506666660606660666606060606600000000000000060\
066433333333333466066666660505050506605506000000664333333333334666600006066660666053350666666006606660550606060606666066606064333333333334660060000000000000006605050506666066605066666055000600000000000000066603006660666606330033555066003060666666060606066660666060600000000000000060066333333333336605066606666050505066660066605000663333333333366050033306660666606033050055066000000605506606060606060666666606633333333333660060000000000000006605050505066666660666605506600600000000000000066050333066660666063066605050000506666660606660666606060606600000000000000060\
066433333333333466606666660505050506605066060600664333333333334666030006066660666033500666666006606600550006060600600060006064333333333334660066000000000000066605050500600060005066666055500660000000000000666603006660666066300033555066003060666666060606006000600000660000000000000660063333333333333605000600060050505066660666605000633333333333336050003306660666660030055550666006060660506606060606060666666166333333333333360066000000000000066605050505066666616666053050600660000000000000660055033606660666063066605550000506666666000060006006060606660000000000000660\
064333333333333346606060060505050506600666363600643333333333333460533000006000600033506666666006050000550006060600000600000643333333333333460066600060006000666605050506000600005000666055000666000600060006666660300066006063300335050666003060666666060606000006000060666000600060006660066333333333336605000060006050505066666666605000663333333333366605003300060006060330500550666006363666006606060606060660600066633333333333660066000000000000066605050505060060606666605506600660000000000000600505033306000600063066660506000506666660600006000006060606660000000000000660\
063333333333333336606006605050505066605066363600633333333333333360553300060006000035006666666006050660506606060606666666606633333333333333360066666600000666666605050506666666600220666055500666666000006666666660300006000663000350050666003060666666000606066666666060666666000006666660066643333333466660066666666050500066666666605000666433333334666605000300006000660300555550666006363660506600000006060666006066664333333346660066600000000000666660505050506600606666660066600666000000000006605500503300006000063066660506000506666660606666066606060606666000000000006660\
063333333333333336606666605050505066605506000000633333333333333366055300006666666035066666666006600660500000000006666666606633333333333333360066666000000066666605050506666666600226660000000666660000000666666666006666660663003355550666003060666666000006066666666006666660000000666660066643333333466660066666666050000066666666605000666433333334666660500306666666003305005550666000000605506600000000600666666066664333333346660066660000000006666660505050506666606666605506600666600000000066605555503300666666030066660506000506666666006666666600000006666600000000066660\
063333333333333336000000000000000006660550660300633333333333333366055330060066660050066666666006660005506603333300000000006633333333333333360066666000000066666600000000000000000206666033300666660000000666666666000666600633003355555066000006666666000000000000000066666660000000666660066664333334666666000000000000000066666666660000666643333346666660500000666600603005555550666003066055066603333300000000000066666433333466660066666000000066666600000000000000006666053050600666660000000666660550550306066660030666660506000066666666600000000003333306666660000000666660\
063333333633333336003333333333333306660550660300633333336333333366050530006606606050666666666006666605506605555533333333306633333336333333360066666000000066666003333333333333302206666603300666660000000666666666606066060630033505555066006066666666033300000000000066666660000000666660066666333336666666033333333333333066666666666000666663333366666666050006066066033050055550666003066055066005000533330000000006666633333666660066666600000666666603333333333333306666053050600666666000006666660550050306606606000666666066000666666666603333333333030303666666000006666660\
066333334643333360036663666636663306666050660300663333346433333660555530006660060000666666666006666660066005505555555555550663333346433333660066666600000666666030003000030003300066666660300666666000006666666666600600660630035005555506006666666660500033333333333306666666000006666660066666633366666660036633666633666306666666666600666666333666666666605000600666033055555555066003066050666055505500053333333306666663336666660066666660006666666603300030000300030666053050600666666600066666605555550360660060600666666066006666666666030303030305050500666666600066666660\
066633346664333660363363633636336330666600066000666333466643336660550530006060606006666666666006666666660500500050005000500066333466643336660066666660006666660303303033030330330066666666000666666600066666666666600060600630035555555550006666666605550550005000500050666666600066666660066666663666666600363633633633633630666666666600666666636666666666605506060606033050055555066000660006660555555550550005000550666666366666660066666666066666666033033030330303303066605506600666666660666666005550550360060600000666666066006666666660050505050505555555066666660666666660\
066666666666666603633363633636333633066666666600666666666666666605555530006606060066666666666006666666605555550555055505550506666666666666660066666666666666603033303033030333033006666666600666666666666666666666606006060630035555555555006666666055555555055505550555066666666666666660066666666666666003633633633633633363066666666600666666666666666666660500606066033055555555506006666666605555555555555055505555066666666666660066666666666666660330333030330303330306660066600666666666666660055550050360606006006666666666006666666605555555555555555555506666666666666660\
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
"};

void set_pixel(pixels p, int x, int y, RGBA colour) {
  ASSERT(x >= 0 && x < p.w);
  ASSERT(y >= 0 && y < p.h);
  int i = x + y * p.w;

  p.data[4 * i + 0] = colour.v[0];
  p.data[4 * i + 1] = colour.v[1];
  p.data[4 * i + 2] = colour.v[2];
  p.data[4 * i + 3] = colour.v[3];
}

RGBA *get_pixel(pixels p, int x, int y) {
  ASSERT(x >= 0 && x < p.w);
  ASSERT(y >= 0 && y < p.h);
  int i = x + y * p.w;

  return (RGBA *)&(p.data[4 * i]);
}

void draw_fill(pixels p, RGBA colour) {
  int num_bytes = 4 * p.w * p.h;
  if (colour.v[0] == colour.v[1] && colour.v[1] == colour.v[2] &&
      colour.v[2] == colour.v[3]) {
    memset(p.data, colour.v[0], (uZ)num_bytes);
    return;
  }

  for (u8 *head = p.data; head < p.data + num_bytes; head += 4) {
    head[0] = colour.v[0];
    head[1] = colour.v[1];
    head[2] = colour.v[2];
    head[3] = colour.v[3];
  }
}

void draw_line(pixels p, int line_x0, int line_y0, int line_x1, int line_y1,
               int thickness, RGBA colour) {
  int start_x = MAX(0 + 0, MIN(line_x0, line_x1));
  int start_y = MAX(0 + 0, MIN(line_y0, line_y1));
  int end_x   = MIN(p.w - 1, MAX(line_x0, line_x1));
  int end_y   = MIN(p.h - 1, MAX(line_y0, line_y1));

  if (line_x0 == line_x1) {
    if (line_x0 < 0 || line_x0 >= p.w) {
      return;
    }
    for (int y = start_y; y <= end_y; ++y) {
      for (int dx = 0; dx < MIN(thickness, p.w - line_x0); ++dx) {
        set_pixel(p, line_x0 + dx, y, colour);
      }
    }
    return;
  } else if (line_y0 == line_y1) {
    if (line_y0 < 0 || line_y0 >= p.h) {
      return;
    }
    for (int x = start_x; x <= end_x; ++x) {
      for (int dy = 0; dy < MIN(thickness, p.h - line_y0); ++dy) {
        set_pixel(p, x, line_y0 + dy, colour);
      }
    }
  } else {
    ASSERT(0); // Only straight lines
  }
}

void draw_rect(pixels p, int rect_x, int rect_y, int rect_w, int rect_h,
               int thickness, RGBA colour) {
  draw_line(p, rect_x, rect_y, rect_x + rect_w - 1, rect_y, thickness, colour);
  draw_line(p, rect_x, rect_y + rect_h - thickness, rect_x + rect_w - 1,
            rect_y + rect_h - thickness, thickness, colour);
  draw_line(p, rect_x, rect_y, rect_x, rect_y + rect_h - 1, thickness, colour);
  draw_line(p, rect_x + rect_w - thickness, rect_y, rect_x + rect_w - thickness,
            rect_y + rect_h - 1, thickness, colour);
}

void draw_glyph(pixels p, glyph_sheet sheet, int glyph_index, int gx, int gy,
                RGBA **palette, bool flipped = false) {

  int x_offset_start = MAX(0, 0 - gx);
  int y_offset_start = MAX(0, 0 - gy);
  int x_offset_end   = MAX(0, gx + sheet.glyph_w - p.w);
  int y_offset_end   = MAX(0, gy + sheet.h - p.h);

  for (int y = y_offset_start; y < sheet.h - y_offset_end; ++y) {
    for (int x = x_offset_start; x < sheet.glyph_w - x_offset_end; ++x) {
      int rx = flipped ? (sheet.glyph_w - x - 1) : x;
      int ry = flipped ? (sheet.h - y - 1) : y;

      int sheet_i = rx + ry * sheet.w + glyph_index * sheet.glyph_w;

      RGBA *colour = palette[sheet.data[sheet_i] - '0'];

      if (colour) {
        int px = x + gx;
        int py = y + gy;
        int pi = px + py * p.w;

        p.data[4 * pi + 0] = colour->v[0];
        p.data[4 * pi + 1] = colour->v[1];
        p.data[4 * pi + 2] = colour->v[2];
        p.data[4 * pi + 3] = colour->v[3];
      }
    }
  }
}

void draw_glyph_pair_h(pixels p, glyph_sheet sheet, int gi, int gx, int gy,
                       RGBA **pal) {
  int mx = p.w - sheet.glyph_w - gx;
  draw_glyph(p, sheet, gi, gx, gy, pal);
  draw_glyph(p, sheet, gi, mx, gy, pal);
}
void draw_glyph_pair_v(pixels p, glyph_sheet sheet, int gi, int gx, int gy,
                       RGBA **pal) {
  int my = p.h - sheet.h - gy;
  draw_glyph(p, sheet, gi, gx, gy, pal);
  draw_glyph(p, sheet, gi, gx, my, pal, true);
}
void draw_glyph_pair_hv(pixels p, glyph_sheet sheet, int gi, int gx, int gy,
                        RGBA **pal) {
  int mx = p.w - sheet.glyph_w - gx;
  int my = p.h - sheet.h - gy;
  draw_glyph(p, sheet, gi, gx, gy, pal);
  draw_glyph(p, sheet, gi, mx, my, pal, true);
}
void draw_glyph_quadruplet(pixels p, glyph_sheet sheet, int gi, int gx, int gy,
                           RGBA **pal) {
  int mx = p.w - sheet.glyph_w - gx;
  int my = p.h - sheet.h - gy;
  draw_glyph(p, sheet, gi, gx, gy, pal);
  draw_glyph(p, sheet, gi, mx, gy, pal);
  draw_glyph(p, sheet, gi, gx, my, pal, true);
  draw_glyph(p, sheet, gi, mx, my, pal, true);
}

void draw_pattern_fill(pixels p, glyph_sheet sheet, int gi, RGBA **pal) {
  for (int dy = 0; dy <= p.h / sheet.h; ++dy) {
    for (int dx = 0; dx <= p.w / sheet.glyph_w; ++dx) {
      draw_glyph(p, sheet, gi, dx * sheet.glyph_w, dy * sheet.h, pal);
    }
  }
}

void cut_corners(pixels p) {
  for (int i = 0; i < 4; ++i) {
    int  x  = (i % 2) ? p.w - 1 : 0;
    int  y  = (i / 2) ? p.h - 1 : 0;
    int  cx = (i % 2) ? p.w - 2 : 1;
    int  cy = (i / 2) ? p.h - 2 : 1;
    RGBA c  = *get_pixel(p, x, y);
    set_pixel(p, cx, cy, c);
    set_pixel(p, x, y, {{0, 0, 0, 0}});
    set_pixel(p, x, cy, {{0, 0, 0, 0}});
    set_pixel(p, cx, y, {{0, 0, 0, 0}});
  }
}

// Card_ID indexes into deck of 64 textures
#define CARD_ID_EMPTY 0
#define CARD_ID_FACEDOWN 16
#define CARD_ID(c)                                                             \
  (((c).flip == FACEUP) ? (((c).suit << 4) + (c).rank) : CARD_ID_FACEDOWN)

void draw_card(pixels card_tex, int card_id) {
  int suit = card_id / 16;
  int rank = card_id % 16;

  RGBA *full_colour[8] = {&black, &blue,   &green, &red,
                          &pink,  &yellow, &white, &cyan};
  RGBA *tri_colour[3]  = {nullptr, (suit % 2) ? &black : &red,
                         (suit % 2) ? &cyan : &pink};

  if (card_id == CARD_ID_EMPTY) {
    draw_fill(card_tex, {{0, 0, 0, 0}});
  } else if (card_id == CARD_ID_FACEDOWN) {
    draw_pattern_fill(card_tex, card_backs, 0, full_colour);
    draw_rect(card_tex, 3, 3, card_tex.w - 6, card_tex.h - 6, 1, black);
    draw_rect(card_tex, 1, 1, card_tex.w - 2, card_tex.h - 2, 2, white);
    set_pixel(card_tex, 3, 3, white);
    set_pixel(card_tex, card_tex.w - 4, 3, white);
    set_pixel(card_tex, 3, card_tex.h - 4, white);
    set_pixel(card_tex, card_tex.w - 4, card_tex.h - 4, white);
  } else if (rank < ACE || rank > KING) {
    draw_fill(card_tex, red); // Unused texture
  } else {
    draw_fill(card_tex, white);

    if (rank < JACK) {
      draw_glyph_pair_hv(card_tex, rank_sheet, rank - 1, 2, 4, tri_colour);
      draw_glyph_pair_hv(card_tex, suit_sheet_small, suit, 2, 17, tri_colour);
    } else {
      draw_glyph_pair_hv(card_tex, rank_sheet, rank - 1, 1, 4, tri_colour);
      draw_glyph_pair_hv(card_tex, suit_sheet_smaller, suit, 2, 17, tri_colour);
    }

    int center_x = (card_tex.w - sheet_suit_L.glyph_w) / 2;
    int center_y = (card_tex.h - sheet_suit_L.h) / 2;
    int column_1 = 4 + rank_sheet.glyph_w + 1;
    int row_1    = 4 + rank_sheet.h + 1 - sheet_suit_L.h / 2;
    int row_2    = (row_1 + card_tex.h - sheet_suit_L.h) / 3;

    switch (rank) {
    case ACE:
      if (suit == SPADES) {
        draw_glyph(card_tex, sheet_art, 0, (card_tex.w - sheet_art.glyph_w) / 2,
                   (card_tex.h - sheet_art.h) / 2, tri_colour);
      } else {
        draw_glyph(card_tex, sheet_suit_L, suit, center_x, center_y,
                   tri_colour);
      }
      break;
    case 2:
      draw_glyph_pair_v(card_tex, sheet_suit_L, suit, center_x, row_1,
                        tri_colour);
      break;
    case 3:
      draw_glyph_pair_v(card_tex, sheet_suit_L, suit, center_x, row_1,
                        tri_colour);
      draw_glyph(card_tex, sheet_suit_L, suit, center_x, center_y, tri_colour);
      break;
    case 4:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      break;
    case 5:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph(card_tex, sheet_suit_L, suit, center_x, center_y, tri_colour);
      break;
    case 6:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph_pair_h(card_tex, sheet_suit_L, suit, column_1, center_y,
                        tri_colour);
      break;
    case 7:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph_pair_h(card_tex, sheet_suit_L, suit, column_1, center_y,
                        tri_colour);
      draw_glyph(card_tex, sheet_suit_L, suit, center_x, (row_1 + center_y) / 2,
                 tri_colour);
      break;
    case 8:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_2,
                            tri_colour);
      break;
    case 9:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_2,
                            tri_colour);
      draw_glyph(card_tex, sheet_suit_L, suit, center_x, center_y, tri_colour);
      break;
    case 10:
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_1,
                            tri_colour);
      draw_glyph_quadruplet(card_tex, sheet_suit_L, suit, column_1, row_2,
                            tri_colour);
      draw_glyph_pair_v(card_tex, sheet_suit_L, suit, center_x,
                        (row_1 + row_2) / 2, tri_colour);
      break;
    case JACK:
    case QUEEN:
    case KING:
      draw_glyph(card_tex, face_sheet, (rank - JACK) + 3 * suit,
                 (card_tex.w - face_sheet.glyph_w) / 2,
                 (card_tex.h - face_sheet.h) / 2, full_colour);
      break;
    };
  }
  draw_rect(card_tex, 0, 0, card_tex.w, card_tex.h, 1, black);
  cut_corners(card_tex);
}

GLuint sdlgl_create_texture_deck(int w, int h, arena mem) {
  u8 *data = arena_push_bytes(&mem, 4 * w * h);

  pixels card_tex = {.data = data, .w = w, .h = h};

  GLuint ID;
  glActiveTexture(GL_TEXTURE0);
  glGenTextures(1, &ID);
  glBindTexture(GL_TEXTURE_2D_ARRAY, ID);

  glTexStorage3D(GL_TEXTURE_2D_ARRAY, 1, GL_RGBA8, w, h, 64);
  for (int i = 0; i < 64; ++i) {
    draw_card(card_tex, i);

    glTexSubImage3D(GL_TEXTURE_2D_ARRAY, 0, 0, 0, i, w, h, 1, GL_RGBA,
                    GL_UNSIGNED_BYTE, data);
  }
  glTexParameteri(GL_TEXTURE_2D_ARRAY, GL_TEXTURE_MAG_FILTER, GL_NEAREST);

  return ID;
}
